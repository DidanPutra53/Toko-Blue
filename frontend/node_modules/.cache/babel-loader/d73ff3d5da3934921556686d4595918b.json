{"ast":null,"code":"import _regeneratorRuntime from\"E:/document/e-commerce/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"E:/document/e-commerce/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import React,{Fragment,useEffect}from'react';import{useDispatch,useSelector}from'react-redux';import MetaData from'../layout/MetaData';import{useAlert}from'react-alert';import{createOrder,clearErrors}from'../../actions/orderAction';import{useStripe,useElements,CardNumberElement,CardExpiryElement,CardCvcElement}from'@stripe/react-stripe-js';import axios from'axios';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var options={styles:{base:{fontSize:'16px'},invalid:{color:'#9e2146'}}};var Payment=function Payment(_ref){var history=_ref.history;var alert=useAlert();var stripe=useStripe();var elements=useElements();var dispatch=useDispatch();var _useSelector=useSelector(function(state){return state.auth;}),user=_useSelector.user;var _useSelector2=useSelector(function(state){return state.cart;}),cartItems=_useSelector2.cartItems,shippingInfo=_useSelector2.shippingInfo;var _useSelector3=useSelector(function(state){return state.newOrder;}),error=_useSelector3.error;useEffect(function(){if(error){alert.error(error);dispatch(clearErrors());}},[dispatch,alert,error]);var order={orderItems:cartItems,shippingInfo:shippingInfo};var orderInfo=JSON.parse(sessionStorage.getItem('orderInfo'));if(orderInfo){order.itemPrice=orderInfo.itemsPrice;order.shippingPrice=orderInfo.shippingPrice;order.totalPrice=orderInfo.totalPrice;}var paymentData={amount:Math.round(orderInfo.totalPrice*100)};var submitHandler=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var res,config,clientSecret,result;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.preventDefault();document.querySelector('.btn-payment').disabled=true;_context.prev=2;config={headers:{'Content-Type':'application/json'}};_context.next=6;return axios.post('/api/v1/payment/process',paymentData,config);case 6:res=_context.sent;clientSecret=res.data.client_secret;if(!(!stripe||!elements)){_context.next=10;break;}return _context.abrupt(\"return\");case 10:_context.next=12;return stripe.confirmCardPayment(clientSecret,{payment_method:{card:elements.getElement(CardNumberElement),billing_details:{name:user.name,email:user.email}}});case 12:result=_context.sent;if(result.error){alert.error(result.error.message);document.querySelector('.btn-payment').disabled=false;}else{if(result.paymentIntent.status==='succeeded'){order.paymentInfo={id:result.paymentIntent.id,status:result.paymentIntent.status};dispatch(createOrder(order));history.push('/success');}else{alert.error('Terjadi Kesalahan Saat Pembayaran');}}_context.next=20;break;case 16:_context.prev=16;_context.t0=_context[\"catch\"](2);document.querySelector('.btn-payment').disabled=false;alert.error(_context.t0.response.data.message);case 20:case\"end\":return _context.stop();}}},_callee,null,[[2,16]]);}));return function submitHandler(_x){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(Fragment,{children:[/*#__PURE__*/_jsx(MetaData,{title:'Pembayaran'}),/*#__PURE__*/_jsx(\"div\",{className:\"keranjang-isi\",children:/*#__PURE__*/_jsx(\"div\",{className:\"list-price\",children:/*#__PURE__*/_jsxs(\"form\",{className:\"price-box\",onSubmit:submitHandler,children:[/*#__PURE__*/_jsx(\"h5\",{children:\"Pembayaran\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"ringkasan-checkout\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"card_num_field\",children:\"Card Number\"}),/*#__PURE__*/_jsx(CardNumberElement,{type:\"text\",className:\"form-control\",options:options})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"card_exp_field\",children:\"Card Expiry\"}),/*#__PURE__*/_jsx(CardExpiryElement,{type:\"text\",className:\"form-control\",options:options})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"card_cvc_field\",children:\"Card Cvc\"}),/*#__PURE__*/_jsx(CardCvcElement,{type:\"text\",className:\"form-control\",options:options})]})]}),/*#__PURE__*/_jsxs(\"button\",{type:\"submit\",className:\"btn-payment\",children:[\"Bayar \",\" - RP. \".concat(orderInfo&&orderInfo.totalPrice)]})]})})})]});};export default Payment;","map":{"version":3,"sources":["E:/document/e-commerce/frontend/src/component/cart/Payment.js"],"names":["React","Fragment","useEffect","useDispatch","useSelector","MetaData","useAlert","createOrder","clearErrors","useStripe","useElements","CardNumberElement","CardExpiryElement","CardCvcElement","axios","options","styles","base","fontSize","invalid","color","Payment","history","alert","stripe","elements","dispatch","state","auth","user","cart","cartItems","shippingInfo","newOrder","error","order","orderItems","orderInfo","JSON","parse","sessionStorage","getItem","itemPrice","itemsPrice","shippingPrice","totalPrice","paymentData","amount","Math","round","submitHandler","e","preventDefault","document","querySelector","disabled","config","headers","post","res","clientSecret","data","client_secret","confirmCardPayment","payment_method","card","getElement","billing_details","name","email","result","message","paymentIntent","status","paymentInfo","id","push","response"],"mappings":"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","sourcesContent":["import React, { Fragment, useEffect } from 'react'\r\n\r\n\r\nimport { useDispatch, useSelector } from 'react-redux';\r\nimport MetaData from '../layout/MetaData';\r\nimport { useAlert } from 'react-alert'\r\nimport { createOrder, clearErrors } from '../../actions/orderAction';\r\nimport { useStripe, useElements, CardNumberElement, CardExpiryElement, CardCvcElement } from '@stripe/react-stripe-js'\r\n\r\nimport axios from 'axios'\r\n\r\nconst options = {\r\n    styles: {\r\n        base: {\r\n            fontSize: '16px'\r\n        },\r\n        invalid: {\r\n            color: '#9e2146'\r\n        }\r\n    }\r\n}\r\n\r\nconst Payment = ({ history }) => {\r\n\r\n    const alert = useAlert()\r\n    const stripe = useStripe()\r\n    const elements = useElements()\r\n    const dispatch = useDispatch()\r\n\r\n    const { user } = useSelector(state => state.auth)\r\n    const { cartItems, shippingInfo } = useSelector(state => state.cart)\r\n    const { error } = useSelector(state => state.newOrder)\r\n\r\n    useEffect(() => {\r\n\r\n        if (error) {\r\n            alert.error(error)\r\n            dispatch(clearErrors())\r\n        }\r\n\r\n    }, [dispatch, alert, error])\r\n\r\n    const order = {\r\n        orderItems: cartItems,\r\n        shippingInfo\r\n    }\r\n\r\n    const orderInfo = JSON.parse(sessionStorage.getItem('orderInfo'))\r\n    if (orderInfo) {\r\n        order.itemPrice = orderInfo.itemsPrice\r\n        order.shippingPrice = orderInfo.shippingPrice\r\n        order.totalPrice = orderInfo.totalPrice\r\n    }\r\n\r\n    const paymentData = {\r\n        amount: Math.round(orderInfo.totalPrice * 100)\r\n    }\r\n\r\n    const submitHandler = async (e) => {\r\n        e.preventDefault()\r\n\r\n        document.querySelector('.btn-payment').disabled = true\r\n\r\n        let res\r\n\r\n        try {\r\n            const config = {\r\n                headers: {\r\n                    'Content-Type': 'application/json'\r\n                }\r\n            }\r\n            res = await axios.post('/api/v1/payment/process', paymentData, config)\r\n            const clientSecret = res.data.client_secret\r\n\r\n            if (!stripe || !elements) {\r\n                return\r\n            }\r\n\r\n            const result = await stripe.confirmCardPayment(clientSecret, {\r\n                payment_method: {\r\n                    card: elements.getElement(CardNumberElement),\r\n                    billing_details: {\r\n                        name: user.name,\r\n                        email: user.email,\r\n                    }\r\n                }\r\n            })\r\n\r\n            if (result.error) {\r\n                alert.error(result.error.message)\r\n                document.querySelector('.btn-payment').disabled = false\r\n            } else {\r\n                if (result.paymentIntent.status === 'succeeded') {\r\n\r\n                    order.paymentInfo = {\r\n                        id: result.paymentIntent.id,\r\n                        status: result.paymentIntent.status,\r\n                    }\r\n\r\n                    dispatch(createOrder(order))\r\n\r\n                    history.push('/success')\r\n                } else {\r\n                    alert.error('Terjadi Kesalahan Saat Pembayaran')\r\n                }\r\n            }\r\n\r\n\r\n        } catch (error) {\r\n            document.querySelector('.btn-payment').disabled = false\r\n            alert.error(error.response.data.message)\r\n        }\r\n    }\r\n\r\n    return (\r\n        <Fragment>\r\n            <MetaData title={'Pembayaran'} />\r\n\r\n            <div className=\"keranjang-isi\">\r\n                <div className=\"list-price\">\r\n                    <form className=\"price-box\" onSubmit={submitHandler}>\r\n                        <h5>Pembayaran</h5>\r\n                        <div className=\"ringkasan-checkout\">\r\n                            <div className=\"form-group\">\r\n                                <label htmlFor=\"card_num_field\">Card Number</label>\r\n                                {/* 4000 0027 6000 3184 */}\r\n                                <CardNumberElement\r\n                                    type=\"text\"\r\n                                    className=\"form-control\"\r\n                                    options={options}\r\n                                />\r\n                            </div>\r\n                            <div className=\"form-group\">\r\n                                <label htmlFor=\"card_exp_field\">Card Expiry</label>\r\n                                <CardExpiryElement\r\n                                    type=\"text\"\r\n                                    className=\"form-control\"\r\n                                    options={options}\r\n                                />\r\n                            </div>\r\n                            <div className=\"form-group\">\r\n                                <label htmlFor=\"card_cvc_field\">Card Cvc</label>\r\n                                <CardCvcElement\r\n                                    type=\"text\"\r\n                                    className=\"form-control\"\r\n                                    options={options}\r\n                                />\r\n                            </div>\r\n                        </div>\r\n                        <button\r\n                            type=\"submit\"\r\n                            className=\"btn-payment\"\r\n\r\n                        >\r\n                            Bayar {` - RP. ${orderInfo && orderInfo.totalPrice}`}\r\n                        </button>\r\n                    </form>\r\n                </div>\r\n            </div>\r\n\r\n        </Fragment>\r\n    )\r\n}\r\n\r\nexport default Payment\r\n"]},"metadata":{},"sourceType":"module"}